services:
  icecast:
    image: libretime/icecast:2.4.4
    restart: unless-stopped
    ports:
      - '8000:8000'
    environment:
      ICECAST_SOURCE_PASSWORD: ${ICECAST_SOURCE_PASSWORD:-hackme}
      ICECAST_ADMIN_PASSWORD: ${ICECAST_ADMIN_PASSWORD:-hackmeadmin}
      ICECAST_RELAY_PASSWORD: ${ICECAST_RELAY_PASSWORD:-relaypass}
      ICECAST_LOCATION: ${ICECAST_LOCATION:-Audio Player}
      ICECAST_HOSTNAME: ${ICECAST_HOSTNAME:-icecast}
      ICECAST_MAX_CLIENTS: ${ICECAST_MAX_CLIENTS:-20}
      LOG_SERVICE: icecast
      LOG_ROLE: audio-player
      LOG_COMMIT: ${FLEET_LOG_COMMIT:-unknown}
    volumes:
      - icecast-data:/var/lib/icecast
      - icecast-log:/var/log/icecast2
    healthcheck:
      test: ['CMD-SHELL', 'wget -q --spider http://127.0.0.1:8000/status-json.xsl || exit 1']
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  icecast-data: {}
  icecast-log: {}
