# Permissions Audit — Elevated Operations Controls

| Endpoint / UI Control | Required role / scope (per docs or service) | Observed UI state | Risk |
| --- | --- | --- | --- |
| `/logs/export` API and Logs page “Export TXT/JSON” buttons | Backend requires privileged operator roles (`admin`, `security`, `compliance`, `auditor`, `logs_admin`) or scopes (`logs:export`, `logs:admin`, `logs:*`, `logs:all`, `logs:read-write`, `logs:manage`). UX story also calls out export permissions for auditors.【F:apps/api/src/services/logExport.ts†L29-L78】【F:docs/ux/operator-jobs-and-stories.md†L195-L202】 | Buttons are always rendered and enabled aside from an in-flight download state; no role-aware gating in the page component.【F:apps/ui/src/routes/logs/+page.svelte†L254-L264】 | Non-privileged operators see export controls, but the API returns `403` when headers lack required roles/scopes, producing confusing failures and potential support load.【F:apps/api/src/routes/logs.ts†L203-L241】 |
| `/settings/*` mutations (token rotation, allowed origins, proxy config, pairing lifecycle, operator management, security settings) | Settings stories specify an authenticated admin operator for pairing/network work and admin-only access control changes.【F:docs/ux/operator-jobs-and-stories.md†L206-L224】 | All mutation controls (rotate token, save origins/proxy, start pairing, invite/remove operators, update security) are always active except for local loading spinners; there is no role awareness in the Svelte page.【F:apps/ui/src/routes/settings/+page.svelte†L252-L357】 | API routes accept any bearer token and never inspect roles/scopes, enabling privilege escalation that contradicts documented least-privilege expectations.【F:apps/api/src/routes/settings.ts†L213-L301】 |
| Fleet device quick actions (`POST /fleet/devices/{deviceId}/actions/{actionId}`) and device detail “Actions” buttons | Product requirements state only technician or admin roles may issue remote remediation commands (restart/resync/etc.).【F:docs/prd.md†L56-L78】 | Device detail renders every available action button with no role filtering; any authenticated session can trigger the UI handler.【F:apps/ui/src/routes/fleet/[id]/+page.svelte†L186-L213】 | The current API stub lacks the documented actions endpoint entirely, so calls result in 404s today; once implemented, without role checks this path would allow non-technicians to run privileged actions. Recommend aligning UI gating and backend authorization before enabling the endpoint.【F:apps/ui/src/lib/api/fleet-operations.ts†L32-L52】【F:apps/api/src/routes/fleet.ts†L1-L64】 |
