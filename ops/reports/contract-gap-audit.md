# UI ↔ API Contract Gap Audit

The table below maps current UI-initiated HTTP calls (including `/ui/*` proxy surfaces) to the Fleet OpenAPI specification. Status values:

* `match` – UI call aligns with the documented OpenAPI path.
* `mismatch` – UI call and OpenAPI path differ (path, params, or behaviour).
* `missing` – UI call without OpenAPI coverage, or OpenAPI path unused by the UI.

| UI call | Spec path | Status | Notes |
| --- | --- | --- | --- |
| GET /fleet/layout | /fleet/layout | match | UI loads layout via client helper and server proxy while mocks share the same path; OpenAPI documents the endpoint. 【F:apps/ui/src/lib/api/client.ts†L415-L433】【F:apps/ui/src/lib/api/fleet-operations.ts†L12-L22】【F:apps/ui/src/routes/api/fleet/layout/+server.ts†L1-L7】【F:apps/api/openapi.yaml†L2450-L2476】 |
| GET /fleet/state | — | missing | Legacy state snapshot is still requested by the layout loader and proxy fallback but no OpenAPI path exists. 【F:apps/ui/src/lib/api/client.ts†L418-L433】【F:apps/ui/src/routes/api/fleet/state/+server.ts†L1-L7】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L191-L200】 |
| GET /fleet/overview | /fleet/overview | match | UI loads fleet overview via operations helper and mock proxy; matches OpenAPI. 【F:apps/ui/src/lib/api/fleet-operations.ts†L12-L22】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L197-L206】【F:apps/api/openapi.yaml†L2479-L2494】 |
| GET /fleet/devices/{deviceId} | /fleet/devices/{deviceId} | match | Device detail fetch aligns with spec and mock proxy. 【F:apps/ui/src/lib/api/fleet-operations.ts†L24-L37】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L203-L206】【F:apps/api/openapi.yaml†L2508-L2541】 |
| POST /fleet/devices/{deviceId}/actions/{actionId} | /fleet/devices/{deviceId}/actions/{actionId} | match | Quick action trigger matches OpenAPI; mocks mirror the path. 【F:apps/ui/src/lib/api/fleet-operations.ts†L39-L56】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L208-L212】【F:apps/api/openapi.yaml†L2545-L2584】 |
| GET /health/summary | — | missing | `/ui` and `/api` health summary routes proxy to `/health/summary`, which lacks an OpenAPI definition. 【F:apps/ui/src/routes/ui/health/summary/+server.ts†L1-L6】【F:apps/ui/src/routes/api/health/summary/+server.ts†L1-L6】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L165-L170】 |
| GET /health/events/recent | — | missing | Mock-only `/ui` route exposes recent health events but no API contract exists. 【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L173-L176】 |
| GET /audio/overview | /audio/overview | match | Audio dashboard loads via generated client, with mock fallback matching spec. 【F:apps/ui/src/lib/api/audio-operations.ts†L200-L207】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L215-L224】【F:apps/api/openapi.yaml†L2589-L2646】 |
| POST /audio/library | /audio/library | match | Track uploads call the generated client (multipart) and mock handler, aligning with spec. 【F:apps/ui/src/lib/api/audio-operations.ts†L209-L239】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L389-L407】【F:apps/api/openapi.yaml†L2618-L2671】 |
| POST /audio/playlists | /audio/playlists | match | Playlist creation goes through `AudioApi.createPlaylist` with mock fallback and aligns with spec. 【F:apps/ui/src/lib/api/audio-operations.ts†L242-L254】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L344-L371】【F:apps/api/openapi.yaml†L2706-L2765】 |
| PUT /audio/playlists/{playlistId} | /audio/playlists/{playlistId} | match | UI updates playlists via generated client; mocks mirror the route. 【F:apps/ui/src/lib/api/audio-operations.ts†L256-L270】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L373-L387】【F:apps/api/openapi.yaml†L2768-L2805】 |
| DELETE /audio/playlists/{playlistId}/reorder | /audio/playlists/{playlistId}/reorder | match | Deletion uses the reorder path defined in spec; mocks implement the same URL. 【F:apps/ui/src/lib/api/audio-operations.ts†L272-L284】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L373-L387】【F:apps/api/openapi.yaml†L2808-L2865】 |
| POST /audio/playback | /audio/playback | match | Bulk playback requests align with OpenAPI and mock handler. 【F:apps/ui/src/lib/api/audio-operations.ts†L286-L309】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L301-L332】【F:apps/api/openapi.yaml†L2873-L2899】 |
| GET /audio/devices/{deviceId} | /audio/devices/{deviceId} | match | Device snapshots fetched via generated client and mock route mirror the contract. 【F:apps/ui/src/lib/api/audio-operations.ts†L186-L194】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L227-L237】【F:apps/api/openapi.yaml†L2907-L2937】 |
| POST /audio/devices/{id}/pause&#124;resume&#124;stop&#124;seek&#124;volume | /audio/devices/{deviceId}/pause&#124;resume&#124;stop&#124;seek&#124;volume | match | Control helpers call the generated Audio API for playback control and level updates; mocks implement the same routes. 【F:apps/ui/src/lib/api/audio-operations.ts†L312-L388】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L239-L332】【F:apps/api/openapi.yaml†L2941-L3199】 |
| POST /audio/master-volume | /audio/master-volume | match | Master volume updates align with spec and mock handler. 【F:apps/ui/src/lib/api/audio-operations.ts†L387-L405】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L333-L343】【F:apps/api/openapi.yaml†L3208-L3233】 |
| GET /audio | — | missing | Dashboard still fetches legacy `/audio` aggregate when mocks disabled; no OpenAPI coverage. 【F:apps/ui/src/lib/api/client.ts†L421-L433】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L215-L224】 |
| GET /video/overview | /video/overview | match | UI hits `/video/overview` with mock fallback to legacy TV status; spec documents the target endpoint. 【F:apps/ui/src/lib/api/video-operations.ts†L35-L54】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L395-L406】【F:apps/api/openapi.yaml†L3480-L3505】 |
| GET /video/recordings | /video/recordings | match | Timeline loader targets `/video/recordings` per spec with mock fallback. 【F:apps/ui/src/lib/api/video-operations.ts†L105-L123】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L407-L416】【F:apps/api/openapi.yaml†L3757-L3797】 |
| POST /video/preview | /video/preview | match | Live preview creation posts to `/video/preview`; UI falls back to mock stream when unavailable. 【F:apps/ui/src/lib/api/video-operations.ts†L126-L140】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L455-L464】【F:apps/api/openapi.yaml†L3800-L3829】 |
| GET /video | — | missing | Dashboard still queries legacy `/video` aggregate with mock support, but spec only exposes `/video/overview`. 【F:apps/ui/src/lib/api/client.ts†L424-L433】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L400-L410】 |
| GET /video/tv & POST /video/tv/power&#124;input&#124;volume&#124;mute | /video/devices&#42;, /video/devices/{deviceId}/power&#124;input&#124;mute | mismatch | UI still targets legacy `/video/tv` endpoints; the spec expects device-scoped `/video/devices/{deviceId}` routes for power/input/mute and `/video/devices` listing. 【F:apps/ui/src/lib/api/client.ts†L155-L195】【F:apps/ui/src/lib/api/video-operations.ts†L56-L103】【F:apps/api/openapi.yaml†L3511-L3669】 |
| POST /api/video/power&#124;input&#124;volume&#124;mute | — | missing | Svelte endpoints call local Pi video services directly and are not represented in the public OpenAPI contract. 【F:apps/ui/src/routes/api/video/power/+server.ts†L1-L27】【F:apps/ui/src/routes/api/video/input/+server.ts†L1-L27】【F:apps/ui/src/routes/api/video/volume/+server.ts†L1-L31】【F:apps/ui/src/routes/api/video/mute/+server.ts†L1-L27】 |
| GET /zigbee/overview | /zigbee/overview | match | UI requests `/zigbee/overview` with legacy device fallback; spec covers the endpoint. 【F:apps/ui/src/lib/api/zigbee-operations.ts†L52-L67】【F:apps/api/openapi.yaml†L3836-L3859】 |
| POST /zigbee/devices/{deviceId}/action | /zigbee/devices/{deviceId}/action | match | Quick actions hit the documented device action path with mock fallback. 【F:apps/ui/src/lib/api/zigbee-operations.ts†L69-L90】【F:apps/api/openapi.yaml†L3864-L3894】 |
| POST /zigbee/pairing, DELETE /zigbee/pairing, GET /zigbee/pairing/discovered, POST /zigbee/pairing/{deviceId} | /zigbee/pairing, /zigbee/pairing/discovered, /zigbee/pairing/{deviceId} | match | Pairing flows use documented endpoints with mock fallbacks for start, stop, discovery, and confirmation. 【F:apps/ui/src/lib/api/zigbee-operations.ts†L92-L166】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L467-L505】【F:apps/api/openapi.yaml†L3900-L3988】 |
| GET /zigbee/devices | — | missing | Legacy device polling is used as a fallback when `/zigbee/overview` fails; no OpenAPI path exists. 【F:apps/ui/src/lib/api/zigbee-operations.ts†L21-L47】 |
| GET /zigbee | — | missing | Dashboard still fetches `/zigbee` aggregate (mock-backed) without a matching OpenAPI definition. 【F:apps/ui/src/lib/api/client.ts†L427-L433】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L467-L474】 |
| POST /api/zigbee/pair, POST /api/zigbee/pair/confirm, GET /api/zigbee/discover | — | missing | Local Zigbee device proxies call Pi coordinator services directly and are outside the documented API. 【F:apps/ui/src/routes/api/zigbee/pair/+server.ts†L1-L31】【F:apps/ui/src/routes/api/zigbee/pair/confirm/+server.ts†L1-L33】【F:apps/ui/src/routes/api/zigbee/discover/+server.ts†L1-L28】 |
| GET /camera/overview | /camera/overview | match | Camera overview requests hit `/camera/overview` with `/camera` fallback; spec defines the primary path. 【F:apps/ui/src/lib/api/camera-operations.ts†L19-L37】【F:apps/api/openapi.yaml†L4007-L4032】 |
| PUT /camera/active | /camera/active | match | Active camera selection aligns with spec; mock proxy mirrors behaviour. 【F:apps/ui/src/lib/api/camera-operations.ts†L43-L63】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L605-L613】【F:apps/api/openapi.yaml†L4035-L4062】 |
| POST /camera/events/{eventId}/ack & /camera/events/{eventId}/clip | /camera/events/{eventId}/ack & /camera/events/{eventId}/clip | match | Event acknowledgement and clip requests follow the documented paths; mocks proxy the same URLs. 【F:apps/ui/src/lib/api/camera-operations.ts†L65-L115】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L635-L639】【F:apps/api/openapi.yaml†L4187-L4224】 |
| POST /camera/{cameraId}/refresh | /camera/{cameraId}/refresh | match | Preview refresh hits the documented endpoint with mock fallback. 【F:apps/ui/src/lib/api/camera-operations.ts†L117-L139】【F:apps/api/openapi.yaml†L4253-L4276】 |
| GET /camera | — | missing | Fallback camera snapshot (`/camera`) is still invoked when `/camera/overview` fails and is mock-backed without a spec entry. 【F:apps/ui/src/lib/api/camera-operations.ts†L29-L35】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L605-L613】 |
| GET /ui/camera/summary (→ /camera/summary) | — | missing | UI exposes a camera summary proxy used for mocks, but `/camera/summary` is not defined in the spec. 【F:apps/ui/src/routes/ui/camera/summary/+server.ts†L1-L6】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L617-L620】 |
| GET /ui/camera/events (→ /camera/events) | /camera/events | match | `/ui` proxy forwards to the documented camera events feed with mock fallback. 【F:apps/ui/src/routes/ui/camera/events/+server.ts†L1-L6】【F:apps/api/openapi.yaml†L4065-L4149】 |
| GET /logs | /logs | match | The generated `LogsApi.getSnapshot` helper aligns with the `/logs` specification. 【F:apps/ui/src/lib/api/client.ts†L217-L231】【F:apps/api/openapi.yaml†L4281-L4310】 |
| GET /logs/stream | /logs/stream | match | Generated streaming helper targets `/logs/stream` per spec. 【F:apps/ui/src/lib/api/client.ts†L217-L231】【F:apps/api/openapi.yaml†L4312-L4341】 |
| GET /logs/query | /logs/query | match | Custom query helper builds device/level filters that align with the `/logs/query` contract. 【F:apps/ui/src/lib/api/logs-operations.ts†L101-L149】【F:apps/api/openapi.yaml†L4345-L4411】 |
| EventSource /logs/stream (deviceId/correlationId params) | /logs/stream | mismatch | UI stream builder sends `deviceId`/`correlationId` query keys, but the spec expects `source` and `q`. 【F:apps/ui/src/lib/api/logs-operations.ts†L101-L149】【F:apps/ui/src/lib/api/logs-operations.ts†L171-L214】【F:apps/api/openapi.yaml†L4312-L4341】 |
| GET /ui/logs (→ /logs) | /logs | match | `/ui` proxy forwards to `/logs` with mock fallback. 【F:apps/ui/src/routes/ui/logs/+server.ts†L1-L6】【F:apps/api/openapi.yaml†L4281-L4310】 |
| GET /ui/logs/stream (→ /logs/stream) | /logs/stream | match | `/ui` SSE proxy forwards to the documented stream endpoint. 【F:apps/ui/src/routes/ui/logs/stream/+server.ts†L1-L6】【F:apps/api/openapi.yaml†L4312-L4341】 |
| GET /settings | /settings | match | Settings load uses `/settings` with mock fallback as documented. 【F:apps/ui/src/lib/api/settings-operations.ts†L14-L22】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L511-L520】【F:apps/api/openapi.yaml†L4481-L4500】 |
| PATCH /settings/proxy | /settings/proxy | match | Proxy updates call the documented PATCH endpoint with mock support. 【F:apps/ui/src/lib/api/settings-operations.ts†L24-L37】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L517-L523】【F:apps/api/openapi.yaml†L4503-L4539】 |
| POST /settings/api-token | /settings/api-token | match | Token rotation endpoint matches spec and mock behaviour. 【F:apps/ui/src/lib/api/settings-operations.ts†L38-L54】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L526-L531】【F:apps/api/openapi.yaml†L4542-L4573】 |
| PUT /settings/allowed-origins | /settings/allowed-origins | match | Allowed origin updates align with OpenAPI and mocks. 【F:apps/ui/src/lib/api/settings-operations.ts†L55-L73】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L532-L540】【F:apps/api/openapi.yaml†L4576-L4612】 |
| POST /settings/pairing/start&#124;cancel&#124;{candidateId}/claim | /settings/pairing/start&#124;cancel&#124;{candidateId}/claim | match | Pairing lifecycle calls match documented settings endpoints with mock fallbacks. 【F:apps/ui/src/lib/api/settings-operations.ts†L74-L136】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L541-L560】【F:apps/api/openapi.yaml†L4617-L4712】 |
| POST /settings/operators & DELETE /settings/operators/{operatorId} | /settings/operators & /settings/operators/{operatorId} | match | Operator invite/remove flows hit documented endpoints with mock support. 【F:apps/ui/src/lib/api/settings-operations.ts†L137-L187】【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L572-L604】【F:apps/api/openapi.yaml†L4733-L4825】 |
| — | /audio/library/uploads | missing | UI never calls the upload registration helper; only direct `/audio/library` uploads are implemented. 【F:apps/api/openapi.yaml†L2676-L2703】 |
| — | GET /audio/playlists | missing | Playlist listing endpoint is defined in the spec but the UI relies on `/audio/overview` instead. 【F:apps/api/openapi.yaml†L2706-L2765】 |
| — | POST /audio/playlists/{playlistId}/reorder | missing | Reorder operation exists in the spec but the UI has no direct drag-and-drop reorder call. 【F:apps/api/openapi.yaml†L2808-L2844】 |
| — | GET /audio/playback/sessions & POST /audio/playback/sessions | missing | Session history/creation endpoints are defined but no UI workflow surfaces them. 【F:apps/api/openapi.yaml†L2969-L3059】 |
| — | POST /audio/playback/sessions/{sessionId}/sync | missing | Sync tuning endpoint has no UI caller yet. 【F:apps/api/openapi.yaml†L3031-L3076】 |
| — | GET /video/devices & POST /video/devices/{deviceId}/power&#124;input&#124;mute | missing | Spec exposes device-scoped control routes but UI still calls legacy `/video/tv` paths. 【F:apps/api/openapi.yaml†L3511-L3669】 |
| — | POST /video/recordings/{recordingId}/export | missing | UI lacks an export action even though the spec defines it. 【F:apps/api/openapi.yaml†L3709-L3749】 |
| — | /zigbee/rules&#42; | missing | Rule authoring/validation/simulation endpoints are defined but no UI flow consumes them. 【F:apps/api/openapi.yaml†L3236-L3476】 |
| — | GET /camera/events/{eventId} | missing | Detailed event fetch is documented but the UI relies on bulk feeds and does not request individual events. 【F:apps/api/openapi.yaml†L4154-L4184】 |
| — | POST /logs/export & GET /logs/jobs/{id} | missing | Export workflow is specified but no UI surface schedules or retrieves exports. 【F:apps/api/openapi.yaml†L4414-L4463】 |
| — | GET /settings/operators & PUT /settings/operators/{operatorId} | missing | Operator listing/edit endpoints exist in the spec but UI consolidates data under `/settings` and lacks edit flow. 【F:apps/api/openapi.yaml†L4733-L4799】 |
| — | GET /settings/security & PATCH /settings/security | missing | Security settings endpoints are defined but have no UI coverage. 【F:apps/api/openapi.yaml†L4869-L4898】 |
| GET /ui/camera/streams & /ui/camera/streams/{id}/status | — | missing | Mock camera stream status endpoints exist for UI demos but lack spec coverage. 【F:apps/ui/src/routes/ui/[...proxy]/+server.ts†L623-L632】 |
